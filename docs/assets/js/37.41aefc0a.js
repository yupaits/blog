(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{173:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("blockquote",[a("p",[t._v("部分内容引用自: "),a("a",{attrs:{href:"https://yq.aliyun.com/articles/60165",target:"_blank",rel:"noopener noreferrer"}},[t._v("利用Zipkin对Spring Cloud应用进行服务追踪分析"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("针对服务化应用全链路追踪的问题，Google发表了"),a("a",{attrs:{href:"http://research.google.com/pubs/pub36356.html?spm=a2c4e.11153959.blogcont60165.8.6c6808bcBuWAJb",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dapper论文"),a("OutboundLink")],1),t._v("，介绍了他们如何进行服务追踪分析。其基本思路是在服务调用的请求和相应中加入ID，标明上下游请求的关系。")]),t._v(" "),a("p",[t._v("对用Dapper的开源实现是"),a("a",{attrs:{href:"http://zipkin.io/?spm=a2c4e.11153959.blogcont60165.9.6c6808bcBuWAJb",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zipkin"),a("OutboundLink")],1),t._v("，支持多种语言包括JavaScript，Python，Java, Scala, Ruby, C#, Go等。其中Java由多种不同的库来支持。")]),t._v(" "),a("p",[t._v("Spring Cloud Sleuth是对Zipkin的一个封装，对于Span、Trace等信息的生成、接入HTTP Request，以及向Zipkin Server发送采集信息等全部自动完成。本文介绍如何在Spring Cloud中集成Spring Cloud Sleuth实现服务链路追踪。")]),t._v(" "),a("p",[t._v("Spring Cloud Sleuth的概念图如下：")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"快速搭建微服务-服务链路追踪"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速搭建微服务-服务链路追踪","aria-hidden":"true"}},[this._v("#")]),this._v(" 快速搭建微服务-服务链路追踪")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://yqfile.alicdn.com/8ca36080f126c58f3f8cdbe02946832a8f1f82ba.png",alt:"Spring Cloud Sleuth概念图"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"服务端配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务端配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Maven 依赖")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.zipkin.java"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("zipkin-autoconfigure-ui"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("runtime"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-sleuth-zipkin-stream"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-sleuth"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-stream-binder-rabbit"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("mysql-connector-java"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("runtime"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-jdbc"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("配置信息")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sleuth"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("datasource")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("driver-class-name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.mysql.jdbc.Driver\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("sleuth")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("stream")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("rabbitmq")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("5672")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("zipkin")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("启动类加上 "),s("code",[this._v("@EnableZipkinStreamServer")]),this._v(" 注解声明当前应用为Sleuth服务端。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"客户端配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Maven 依赖")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-sleuth-stream"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-sleuth"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-stream-binder-rabbit"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("配置信息")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("rabbitmq")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("5672")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"建表sql脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建表sql脚本","aria-hidden":"true"}},[this._v("#")]),this._v(" 建表SQL脚本")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用MySQL存储链路追踪信息时，需要使用"),s("code",[this._v("io.zipkin.java:zipkin-storage-mysql")]),this._v("包内的"),s("code",[this._v("mysql.sql")]),this._v("脚本创建数据表，该脚本的内容如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("IF")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("255")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("parent_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("debug"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIT")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("start_ts"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Span.timestamp(): epoch micros used for endTs query and to implement TTL'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("duration"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Span.duration(): micros used for minDuration and maxDuration query'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" ROW_FORMAT"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("COMPRESSED "),a("span",{attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("SET")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),a("span",{attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8_general_ci"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("KEY")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'ignore insert on duplicate'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for joining with zipkin_annotations'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTracesByIds'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces and getSpanNames'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_spans "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("start_ts"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces ordering and range'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("IF")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'coincides with zipkin_spans.trace_id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("span_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'coincides with zipkin_spans.id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_key"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("255")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'BinaryAnnotation.key or Annotation.value if type == -1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_value"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BLOB")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'BinaryAnnotation.value(), which must be smaller than 64KB'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_type"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INT")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'BinaryAnnotation.type() or -1 if Annotation'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_timestamp"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("endpoint_ipv4"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Null when Binary/Annotation.endpoint is null'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("endpoint_ipv6"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BINARY")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("16")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Null when Binary/Annotation.endpoint is null, or no IPv6 address'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("endpoint_port"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("SMALLINT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Null when Binary/Annotation.endpoint is null'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("endpoint_service_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("255")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Null when Binary/Annotation.endpoint is null'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" ROW_FORMAT"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("COMPRESSED "),a("span",{attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("SET")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),a("span",{attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8_general_ci"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("KEY")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("span_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_key"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_timestamp"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Ignore insert on duplicate'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("span_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for joining with zipkin_spans'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id_high"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces/ByIds'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("endpoint_service_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces and getServiceNames'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_type"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_key"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for getTraces'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_annotations "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("INDEX")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("trace_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("span_id"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("a_key"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'for dependencies job'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("IF")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" zipkin_dependencies "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token keyword"}},[t._v("day")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("DATE")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("255")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("child"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("255")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("call_count"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("error_count"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("BIGINT")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" ROW_FORMAT"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("COMPRESSED "),a("span",{attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("SET")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),a("span",{attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8_general_ci"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" zipkin_dependencies "),a("span",{attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("KEY")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token keyword"}},[t._v("day")]),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),t._v("child"),a("span",{attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br")])])}],!1,null,null,null);e.options.__file="3.md";s.default=e.exports}}]);